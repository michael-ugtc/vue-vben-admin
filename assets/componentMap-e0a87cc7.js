var He=Object.defineProperty,Ve=Object.defineProperties;var We=Object.getOwnPropertyDescriptors;var we=Object.getOwnPropertySymbols;var Ze=Object.prototype.hasOwnProperty,Xe=Object.prototype.propertyIsEnumerable;var Fe=(e,t,n)=>t in e?He(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,A=(e,t)=>{for(var n in t||(t={}))Ze.call(t,n)&&Fe(e,n,t[n]);if(we)for(var n of we(t))Xe.call(t,n)&&Fe(e,n,t[n]);return e},J=(e,t)=>Ve(e,We(t));var B=(e,t,n)=>new Promise((l,s)=>{var m=o=>{try{i(n.next(o))}catch(a){s(a)}},d=o=>{try{i(n.throw(o))}catch(a){s(a)}},i=o=>o.done?l(o.value):Promise.resolve(o.value).then(m,d);i((n=n.apply(e,t)).next())});import{p as v,v as $e,k as q,m as K,_ as H,N as ie,X as qe,I as ke,Y as Ye,Z as Qe,f as Je,$ as xe,n as et,S as tt,b as nt,a0 as at,w as ot}from"./index.js";import{u as ue}from"./useFormItem-d01c3888.js";import{ac as re,o as ne,a7 as Z,N as Re,ad as ve,ae as lt,af as Te,ag as ye,ah as st,$ as Pe,ai as rt,T as Le,aj as it,ak as ut,H as me,al as ct,X as dt,Q as pt,w as ae,am as ft,an as mt,ao as gt,Z as Ie,ap as ht,aq as yt,ar as ce,as as Ue}from"./antd-51a19206.js";import{d as E,f as _,c as R,h as be,w as U,u as w,a7 as b,Z as C,a8 as $,a9 as F,_ as z,aa as oe,F as x,E as N,a0 as M,ac as X,ad as de,N as pe,ai as te,aj as fe,l as h,$ as Se,o as De,p as vt,e as bt,H as _e,a1 as ge,ab as j,x as St,r as Ct,G as wt}from"./vue-ea98dac5.js";import{R as Ft}from"./RadioButtonGroup-c7d88104.js";import{u as _t,B as Oe,a as Be,b as Ae}from"./index-aef5cc20.js";import{b as At}from"./uuid-31b8b5a4.js";import{d as $t}from"./download-2647fd8d.js";import{S as kt}from"./index-14a28206.js";import{_ as Rt}from"./IconPicker.vue_vue_type_script_setup_true_lang-ee339f8c.js";import{C as Tt}from"./index-76898778.js";const Pt=E({name:"ApiRadioGroup",components:{RadioGroup:re.Group,RadioButton:re.Button,Radio:re},props:{api:{type:Function,default:null},params:{type:[Object,String],default:()=>({})},value:{type:[String,Number,Boolean]},isBtn:{type:[Boolean],default:!1},numberToString:v.bool,resultField:v.string.def(""),labelField:v.string.def("label"),valueField:v.string.def("value"),immediate:v.bool.def(!0)},emits:["options-change","change"],setup(e,{emit:t}){const n=_([]),l=_(!1),s=_(!0),m=_([]),d=$e(),{t:i}=q(),[o]=ue(e,"value","change",m),a=R(()=>{const{labelField:p,valueField:c,numberToString:f}=e;return w(n).reduce((D,T)=>{if(T){const L=T[c];D.push(A({label:T[p],value:f?`${L}`:L},ne(T,[p,c])))}return D},[])});be(()=>{e.immediate&&u()}),U(()=>e.params,()=>{!w(s)&&u()},{deep:!0});function u(){return B(this,null,function*(){const p=e.api;if(!(!p||!K(p))){n.value=[];try{l.value=!0;const c=yield p(e.params);if(Array.isArray(c)){n.value=c,r();return}e.resultField&&(n.value=Z(c,e.resultField)||[]),r()}catch(c){}finally{l.value=!1}}})}function r(){t("options-change",w(a))}function g(...p){m.value=p}return{state:o,getOptions:a,attrs:d,loading:l,t:i,handleClick:g,props:e}}});function Lt(e,t,n,l,s,m){const d=b("RadioButton"),i=b("Radio"),o=b("RadioGroup");return C(),$(o,X(e.attrs,{value:e.state,"onUpdate:value":t[0]||(t[0]=a=>e.state=a),"button-style":"solid"}),{default:F(()=>[(C(!0),z(x,null,oe(e.getOptions,a=>(C(),z(x,{key:`${a.value}`},[e.props.isBtn?(C(),$(d,{key:0,value:a.value,disabled:a.disabled,onClick:u=>e.handleClick(a)},{default:F(()=>[N(M(a.label),1)]),_:2},1032,["value","disabled","onClick"])):(C(),$(i,{key:1,value:a.value,disabled:a.disabled,onClick:u=>e.handleClick(a)},{default:F(()=>[N(M(a.label),1)]),_:2},1032,["value","disabled","onClick"]))],64))),128))]),_:1},16,["value"])}const It=H(Pt,[["render",Lt]]),Ut=E({name:"ApiSelect",components:{Select:Re,LoadingOutlined:ve},inheritAttrs:!1,props:{value:{type:Object},numberToString:v.bool,api:{type:Function,default:null},params:v.any.def({}),resultField:v.string.def(""),labelField:v.string.def("label"),valueField:v.string.def("value"),immediate:v.bool.def(!0),alwaysLoad:v.bool.def(!1),options:{type:Array,default:[]}},emits:["options-change","change","update:value"],setup(e,{emit:t}){const n=_([]),l=_(!1),s=_(!1),m=_([]),d=$e(),{t:i}=q(),[o]=ue(e,"value","change",m),a=R(()=>{const{labelField:c,valueField:f,numberToString:D}=e;let T=w(n).reduce((L,V)=>{if(V){const ee=Z(V,f);L.push(J(A({},ne(V,[c,f])),{label:Z(V,c),value:D?`${ee}`:ee}))}return L},[]);return T.length>0?T:e.options});U(()=>o.value,c=>{t("update:value",c)}),U(()=>e.params,()=>{!w(s)&&u()},{deep:!0,immediate:e.immediate});function u(){return B(this,null,function*(){const c=e.api;if(!(!c||!K(c)||l.value)){n.value=[];try{l.value=!0;const f=yield c(e.params);if(s.value=!0,Array.isArray(f)){n.value=f,g();return}e.resultField&&(n.value=Z(f,e.resultField)||[]),g()}catch(f){}finally{l.value=!1}}})}function r(c){return B(this,null,function*(){c&&(e.alwaysLoad?yield u():!e.immediate&&!w(s)&&(yield u()))})}function g(){t("options-change",w(a))}function p(c,...f){t("change",...f),m.value=f}return{state:o,attrs:d,getOptions:a,loading:l,t:i,handleFetch:r,handleChange:p}}});function Dt(e,t,n,l,s,m){const d=b("LoadingOutlined"),i=b("Select");return C(),$(i,X({onDropdownVisibleChange:e.handleFetch},e.$attrs,{onChange:e.handleChange,options:e.getOptions,value:e.state,"onUpdate:value":t[0]||(t[0]=o=>e.state=o)}),de({_:2},[oe(Object.keys(e.$slots),o=>({name:o,fn:F(a=>[pe(e.$slots,o,te(fe(a||{})))])})),e.loading?{name:"suffixIcon",fn:F(()=>[h(d,{spin:""})]),key:"0"}:void 0,e.loading?{name:"notFoundContent",fn:F(()=>[Se("span",null,[h(d,{spin:"",class:"mr-1"}),N(" "+M(e.t("component.form.apiSelectNotFound")),1)])]),key:"1"}:void 0]),1040,["onDropdownVisibleChange","onChange","options","value"])}const Ot=H(Ut,[["render",Dt]]),Bt=E({name:"ApiTree",components:{ATree:lt},props:{api:{type:Function},params:{type:Object},immediate:{type:Boolean,default:!0},resultField:v.string.def(""),afterFetch:{type:Function},value:[Array,Object,String,Number]},emits:["options-change","change","update:value"],setup(e,{attrs:t,emit:n}){const l=_([]),s=_(!1),m=_(!1),d=_([]),[i]=ue(e,"value","change",d),o=R(()=>A(A({},e.api?{treeData:w(l)}:{}),t));function a(...r){n("change",...r)}U(()=>i.value,r=>{n("update:value",r)}),U(()=>e.params,()=>{!w(s)&&u()},{deep:!0}),U(()=>e.immediate,r=>{r&&!s.value&&u()}),De(()=>{e.immediate&&u()});function u(){return B(this,null,function*(){const{api:r,afterFetch:g}=e;if(!r||!K(r))return;m.value=!0,l.value=[];let p;try{p=yield r(e.params)}catch(c){}g&&K(g)&&(p=g(p)),m.value=!1,p&&(ie(p)||(p=Z(p,e.resultField)),l.value=p||[],s.value=!0,n("options-change",l.value))})}return{getAttrs:o,loading:m,handleChange:a,state:i}}});function Nt(e,t,n,l,s,m){const d=b("a-tree");return C(),$(d,X(e.getAttrs,{onSelect:e.handleChange,selectedKeys:e.state,"onUpdate:selectedKeys":t[0]||(t[0]=i=>e.state=i)}),de({_:2},[oe(Object.keys(e.$slots),i=>({name:i,fn:F(o=>[pe(e.$slots,i,te(fe(o||{})))])}))]),1040,["onSelect","selectedKeys"])}const Mt=H(Bt,[["render",Nt]]),Et=E({name:"ApiTreeSelect",components:{ATreeSelect:Te,LoadingOutlined:ve},props:{api:{type:Function},params:{type:Object},immediate:{type:Boolean,default:!0},resultField:v.string.def(""),labelField:v.string.def("title"),valueField:v.string.def("value"),childrenField:v.string.def("children")},emits:["options-change","change"],setup(e,{attrs:t,emit:n}){const l=_([]),s=_(!1),m=_(!1),d=R(()=>A(A({},e.api?{treeData:w(l)}:{}),t)),i={children:e.childrenField,value:e.valueField,label:e.labelField};function o(...u){n("change",...u)}U(()=>e.params,()=>{!w(s)&&a()},{deep:!0}),U(()=>e.immediate,u=>{u&&!s.value&&a()}),De(()=>{e.immediate&&a()});function a(){return B(this,null,function*(){const{api:u}=e;if(!u||!K(u)||m.value)return;m.value=!0,l.value=[];let r;try{r=yield u(e.params)}catch(g){}m.value=!1,r&&(ie(r)||(r=Z(r,e.resultField)),l.value=r||[],s.value=!0,n("options-change",l.value))})}return{getAttrs:d,loading:m,handleChange:o,fieldNames:i}}});function Gt(e,t,n,l,s,m){const d=b("LoadingOutlined"),i=b("a-tree-select");return C(),$(i,X(e.getAttrs,{onChange:e.handleChange,"field-names":e.fieldNames}),de({_:2},[oe(Object.keys(e.$slots),o=>({name:o,fn:F(a=>[pe(e.$slots,o,te(fe(a||{})))])})),e.loading?{name:"suffixIcon",fn:F(()=>[h(d,{spin:""})]),key:"0"}:void 0]),1040,["onChange","field-names"])}const jt=H(Et,[["render",Gt]]),zt=E({name:"ApiCascader",components:{LoadingOutlined:ve,[ye.name]:ye},props:{value:{type:Array},api:{type:Function,default:null},numberToString:v.bool,resultField:v.string.def(""),labelField:v.string.def("label"),valueField:v.string.def("value"),childrenField:v.string.def("children"),asyncFetchParamKey:v.string.def("parentCode"),immediate:v.bool.def(!0),initFetchParams:{type:Object,default:()=>({})},isLeaf:{type:Function,default:null},displayRenderArray:{type:Array}},emits:["change","defaultChange"],setup(e,{emit:t}){const n=_([]),l=_([]),s=_(!1),m=_([]),d=_(!0),{t:i}=q(),[o]=ue(e,"value","change",m);U(n,c=>{const f=a(c);l.value=f},{deep:!0});function a(c){const{labelField:f,valueField:D,numberToString:T,childrenField:L,isLeaf:V}=e;return c.reduce((ee,Y)=>{if(Y){const le=Y[D],se=J(A({},ne(Y,[f,D])),{label:Y[f],value:T?`${le}`:le,isLeaf:V&&typeof V=="function"?V(Y):!1}),S=Reflect.get(Y,L);S&&Reflect.set(se,L,a(S)),ee.push(se)}return ee},[])}function u(){return B(this,null,function*(){const c=e.api;if(!(!c||!K(c))){n.value=[],s.value=!0;try{const f=yield c(e.initFetchParams);if(Array.isArray(f)){n.value=f;return}e.resultField&&(n.value=Z(f,e.resultField)||[])}catch(f){}finally{s.value=!1}}})}function r(c){return B(this,null,function*(){const f=c[c.length-1];f.loading=!0;const D=e.api;if(!(!D||!K(D)))try{const T=yield D({[e.asyncFetchParamKey]:Reflect.get(f,"value")});if(Array.isArray(T)){const L=a(T);f.children=L;return}if(e.resultField){const L=a(Z(T,e.resultField)||[]);f.children=L}}catch(T){}finally{f.loading=!1}})}be(()=>{e.immediate&&u()}),U(()=>e.initFetchParams,()=>{!w(d)&&u()},{deep:!0});function g(c,f){m.value=f,t("defaultChange",c,f)}function p({labels:c,selectedOptions:f}){return w(m).length===f.length?c.join(" / "):e.displayRenderArray?e.displayRenderArray.join(" / "):""}return{state:o,options:l,loading:s,t:i,handleChange:g,loadData:r,handleRenderDisplay:p}}});function Kt(e,t,n,l,s,m){const d=b("LoadingOutlined"),i=b("a-cascader");return C(),$(i,{value:e.state,"onUpdate:value":t[0]||(t[0]=o=>e.state=o),options:e.options,"load-data":e.loadData,"change-on-select":"",onChange:e.handleChange,displayRender:e.handleRenderDisplay},de({_:2},[e.loading?{name:"suffixIcon",fn:F(()=>[h(d,{spin:""})]),key:"0"}:void 0,e.loading?{name:"notFoundContent",fn:F(()=>[Se("span",null,[h(d,{spin:"",class:"mr-1"}),N(" "+M(e.t("component.form.apiSelectNotFound")),1)])]),key:"1"}:void 0]),1032,["value","options","load-data","onChange","displayRender"])}const Ht=H(zt,[["render",Kt]]),Vt=E({name:"ApiTransfer",components:{Transfer:st},props:{value:{type:Array},api:{type:Function,default:null},params:{type:Object},dataSource:{type:Array},immediate:v.bool.def(!0),alwaysLoad:v.bool.def(!1),afterFetch:{type:Function},resultField:v.string.def(""),labelField:v.string.def("title"),valueField:v.string.def("key"),showSearch:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},filterOption:{type:Function},selectedKeys:{type:Array},showSelectAll:{type:Boolean,default:!1},targetKeys:{type:Array}},emits:["options-change","change"],setup(e,{attrs:t,emit:n}){const l=_([]),s=_([]),{t:m}=q(),d=R(()=>A(A({},e.api?{}:{dataSource:w(l)}),t)),i=R(()=>{const{labelField:g,valueField:p}=e;return w(l).reduce((c,f)=>(f&&c.push(J(A({},ne(f,[g,p])),{title:f[g],key:f[p]})),c),[])}),o=R(()=>Array.isArray(e.value)?e.value:Array.isArray(e.targetKeys)?e.targetKeys:[]);function a(g,p,c){s.value=g,n("change",g)}be(()=>{e.immediate&&!e.alwaysLoad&&u()}),U(()=>e.params,()=>{u()},{deep:!0});function u(){return B(this,null,function*(){const g=e.api;if(!g||!K(g)){Array.isArray(e.dataSource)&&(l.value=e.dataSource);return}l.value=[];try{const p=yield g(e.params);if(Array.isArray(p)){l.value=p,r();return}e.resultField&&(l.value=Z(p,e.resultField)||[]),r()}catch(p){}})}function r(){n("options-change",w(i))}return{getTargetKeys:o,getdataSource:i,t:m,getAttrs:d,handleChange:a}}});function Wt(e,t,n,l,s,m){const d=b("Transfer");return C(),$(d,{"data-source":e.getdataSource,"filter-option":e.filterOption,render:i=>i.title,showSelectAll:e.showSelectAll,selectedKeys:e.selectedKeys,targetKeys:e.getTargetKeys,showSearch:e.showSearch,disabled:e.disabled,onChange:e.handleChange},null,8,["data-source","filter-option","render","showSelectAll","selectedKeys","targetKeys","showSearch","disabled","onChange"])}const Zt=H(Vt,[["render",Wt]]),Ne={helpText:{type:String,default:""},maxSize:{type:Number,default:2},maxNumber:{type:Number,default:1/0},accept:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0},uploadParams:{type:Object,default:()=>({})},api:{type:Function,default:null,required:!0},name:{type:String,default:"file"},filename:{type:String,default:null}},Xt=J(A({value:{type:Array,default:()=>[]}},Ne),{showPreviewNumber:{type:Boolean,default:!0},emptyHidePreview:{type:Boolean,default:!1}}),qt={value:{type:Array,default:()=>[]}},Yt={columns:{type:Array,default:null},actionColumn:{type:Object,default:null},dataSource:{type:Array,default:null}},{t:he}=q();function Qt({acceptRef:e,helpTextRef:t,maxNumberRef:n,maxSizeRef:l}){const s=R(()=>{const i=w(e);return i&&i.length>0?i:[]}),m=R(()=>w(s).map(i=>i.indexOf("/")>0||i.startsWith(".")?i:`.${i}`).join(",")),d=R(()=>{const i=w(t);if(i)return i;const o=[],a=w(e);a.length>0&&o.push(he("component.upload.accept",[a.join(",")]));const u=w(l);u&&o.push(he("component.upload.maxSize",[u]));const r=w(n);return r&&r!==1/0&&o.push(he("component.upload.maxNumber",[r])),o.join("，")});return{getAccept:s,getStringAccept:m,getHelpText:d}}var P=(e=>(e.SUCCESS="success",e.ERROR="error",e.UPLOADING="uploading",e))(P||{});function Jt(e){return Me(e.name)}function Me(e){return/\.(jpg|jpeg|png|gif|webp)$/i.test(e)}function xt(e){return new Promise((t,n)=>{const l=new FileReader;l.readAsDataURL(e),l.onload=()=>t({result:l.result,file:e}),l.onerror=s=>n(s)})}const Ee=Symbol("basic-table");function zn(e){vt(Ee,e)}function en(){return bt(Ee)}const{table:tn}=qe,{pageSizeOptions:nn,defaultPageSize:an,fetchSetting:on,defaultSize:ln,defaultSortFn:sn,defaultFilterFn:rn}=tn,Kn="key",Hn=nn,Vn=an,Wn=on,Zn=ln,Xn=sn,qn=rn,Yn="center",Qn="INDEX",un="ACTION",cn=E({name:"TableAction",components:{Icon:ke,PopConfirmButton:Ye,Divider:Pe,Dropdown:Qe,MoreOutlined:rt,Tooltip:Le},props:{actions:{type:Array,default:null},dropDownActions:{type:Array,default:null},divider:v.bool.def(!0),outside:v.bool,stopButtonPropagation:v.bool.def(!1)},setup(e){const{prefixCls:t}=Je("basic-table-action");let n={};e.outside||(n=en());const{hasPermission:l}=xe();function s(u){const r=u.ifShow;let g=!0;return tt(r)&&(g=r),K(r)&&(g=r(u)),g}const m=R(()=>(_e(e.actions)||[]).filter(u=>l(u.auth)&&s(u)).map(u=>{const{popConfirm:r}=u;return J(A(A({getPopupContainer:()=>{var g;return(g=w(n==null?void 0:n.wrapRef))!=null?g:document.body},type:"link",size:"small"},u),r||{}),{onConfirm:r==null?void 0:r.confirm,onCancel:r==null?void 0:r.cancel,enable:!!r})})),d=R(()=>{const u=(_e(e.dropDownActions)||[]).filter(r=>l(r.auth)&&s(r));return u.map((r,g)=>{const{label:p,popConfirm:c}=r;return J(A(A({},r),c),{onConfirm:c==null?void 0:c.confirm,onCancel:c==null?void 0:c.cancel,text:p,divider:g<u.length-1?e.divider:!1})})}),i=R(()=>{var g,p;const r=(((g=n==null?void 0:n.getColumns)==null?void 0:g.call(n))||[]).find(c=>c.flag===un);return(p=r==null?void 0:r.align)!=null?p:"left"});function o(u){return A({getPopupContainer:()=>{var r;return(r=w(n==null?void 0:n.wrapRef))!=null?r:document.body},placement:"bottom"},et(u)?{title:u}:u)}function a(u){if(!e.stopButtonPropagation)return;u.composedPath().find(p=>{var c;return((c=p.tagName)==null?void 0:c.toUpperCase())==="BUTTON"})&&u.stopPropagation()}return{prefixCls:t,getActions:m,getDropdownList:d,getAlign:i,onCellClick:a,getTooltip:o}}});function dn(e,t,n,l,s,m){const d=b("Icon"),i=b("PopConfirmButton"),o=b("Tooltip"),a=b("Divider"),u=b("MoreOutlined"),r=b("a-button"),g=b("Dropdown");return C(),z("div",{class:ge([e.prefixCls,e.getAlign]),onClick:t[0]||(t[0]=(...p)=>e.onCellClick&&e.onCellClick(...p))},[(C(!0),z(x,null,oe(e.getActions,(p,c)=>(C(),z(x,{key:`${c}-${p.label}`},[p.tooltip?(C(),$(o,te(X({key:0},e.getTooltip(p.tooltip))),{default:F(()=>[h(i,te(fe(p)),{default:F(()=>[p.icon?(C(),$(d,{key:0,icon:p.icon,class:ge({"mr-1":!!p.label})},null,8,["icon","class"])):j("",!0),p.label?(C(),z(x,{key:1},[N(M(p.label),1)],64)):j("",!0)]),_:2},1040)]),_:2},1040)):(C(),$(i,te(X({key:1},p)),{default:F(()=>[p.icon?(C(),$(d,{key:0,icon:p.icon,class:ge({"mr-1":!!p.label})},null,8,["icon","class"])):j("",!0),p.label?(C(),z(x,{key:1},[N(M(p.label),1)],64)):j("",!0)]),_:2},1040)),e.divider&&c<e.getActions.length-1?(C(),$(a,{key:2,type:"vertical",class:"action-divider"})):j("",!0)],64))),128)),e.dropDownActions&&e.getDropdownList.length>0?(C(),$(g,{key:0,trigger:["hover"],dropMenuList:e.getDropdownList,popconfirm:""},{default:F(()=>[pe(e.$slots,"more"),e.$slots.more?j("",!0):(C(),$(r,{key:0,type:"link",size:"small"},{default:F(()=>[h(u,{class:"icon-more"})]),_:1}))]),_:3},8,["dropMenuList"])):j("",!0)],2)}const Ge=H(cn,[["render",dn]]),pn=E({components:{Image:it},props:{fileUrl:v.string.def(""),fileName:v.string.def("")}});const fn={class:"thumb"};function mn(e,t,n,l,s,m){const d=b("Image");return C(),z("span",fn,[e.fileUrl?(C(),$(d,{key:0,src:e.fileUrl,width:104},null,8,["src"])):j("",!0)])}const je=H(pn,[["render",mn]]),{t:I}=q();function gn(){return[{dataIndex:"thumbUrl",title:I("component.upload.legend"),width:100,customRender:({record:e})=>{const{thumbUrl:t}=e||{};return t&&h(je,{fileUrl:t},null)}},{dataIndex:"name",title:I("component.upload.fileName"),align:"left",customRender:({text:e,record:t})=>{const{percent:n,status:l}=t||{};let s="normal";return l===P.ERROR?s="exception":l===P.UPLOADING?s="active":l===P.SUCCESS&&(s="success"),h("span",null,[h("p",{class:"truncate mb-1",title:e},[e]),h(ut,{percent:n,size:"small",status:s},null)])}},{dataIndex:"size",title:I("component.upload.fileSize"),width:100,customRender:({text:e=0})=>e&&(e/1024).toFixed(2)+"KB"},{dataIndex:"status",title:I("component.upload.fileStatue"),width:100,customRender:({text:e})=>e===P.SUCCESS?h(me,{color:"green"},{default:()=>I("component.upload.uploadSuccess")}):e===P.ERROR?h(me,{color:"red"},{default:()=>I("component.upload.uploadError")}):e===P.UPLOADING?h(me,{color:"blue"},{default:()=>I("component.upload.uploading")}):e}]}function hn(e){return{width:120,title:I("component.upload.operating"),dataIndex:"action",fixed:!1,customRender:({record:t})=>{const n=[{label:I("component.upload.del"),color:"error",onClick:e.bind(null,t)}];return h(Ge,{actions:n,outside:!0},null)}}}function yn(){return[{dataIndex:"url",title:I("component.upload.legend"),width:100,customRender:({record:e})=>{const{url:t}=e||{};return Me(t)&&h(je,{fileUrl:t},null)}},{dataIndex:"name",title:I("component.upload.fileName"),align:"left"}]}function vn({handleRemove:e,handleDownload:t}){return{width:160,title:I("component.upload.operating"),dataIndex:"action",fixed:!1,customRender:({record:n})=>{const l=[{label:I("component.upload.del"),color:"error",onClick:e.bind(null,n)},{label:I("component.upload.download"),onClick:t.bind(null,n)}];return h(Ge,{actions:l,outside:!0},null)}}}const ze=E({name:"FileList",props:Yt,setup(e){const t=_t();return U(()=>e.dataSource,()=>{St(()=>{var n;(n=t==null?void 0:t.redoModalHeight)==null||n.call(t)})}),()=>{const{columns:n,actionColumn:l,dataSource:s}=e,m=[...n,l];return h("table",{class:"file-table"},[h("colgroup",null,[m.map(d=>{const{width:i=0,dataIndex:o}=d,a={width:`${i}px`,minWidth:`${i}px`};return h("col",{style:i?a:{},key:o},null)})]),h("thead",null,[h("tr",{class:"file-table-tr"},[m.map(d=>{const{title:i="",align:o="center",dataIndex:a}=d;return h("th",{class:["file-table-th",o],key:a},[i])})])]),h("tbody",null,[s.map((d={},i)=>h("tr",{class:"file-table-tr",key:`${i+d.name||""}`},[m.map(o=>{const{dataIndex:a="",customRender:u,align:r="center"}=o,g=u&&K(u);return h("td",{class:["file-table-td",r],key:a},[g?u==null?void 0:u({text:d[a],record:d}):d[a]])})]))])])}}});const bn=E({components:{BasicModal:Oe,Upload:ct,Alert:dt,FileList:ze},props:J(A({},Ne),{previewFileList:{type:Array,default:()=>[]}}),emits:["change","register","delete"],setup(e,{emit:t}){const n=Ct({fileList:[]}),l=_(!1),s=_([]),{accept:m,helpText:d,maxNumber:i,maxSize:o}=wt(e),{t:a}=q(),[u,{closeModal:r}]=Be(),{getStringAccept:g,getHelpText:p}=Qt({acceptRef:m,helpTextRef:d,maxNumberRef:i,maxSizeRef:o}),{createMessage:c}=nt(),f=R(()=>s.value.length>0&&!s.value.every(S=>S.status===P.SUCCESS)),D=R(()=>{const S=s.value.some(k=>k.status===P.SUCCESS);return{disabled:l.value||s.value.length===0||!S}}),T=R(()=>{const S=s.value.some(k=>k.status===P.ERROR);return l.value?a("component.upload.uploading"):a(S?"component.upload.reUploadFailed":"component.upload.startUpload")});function L(S){const{size:k,name:O}=S,{maxSize:G}=e;if(G&&S.size/1024/1024>=G)return c.error(a("component.upload.maxSizeMultiple",[G])),!1;const W={uuid:At(),file:S,size:k,name:O,percent:0,type:O.split(".").pop()};return Jt(S)?xt(S).then(({result:Q})=>{s.value=[...w(s),A({thumbUrl:Q},W)]}):s.value=[...w(s),W],!1}function V(S){const k=s.value.findIndex(O=>O.uuid===S.uuid);k!==-1&&s.value.splice(k,1),t("delete",S)}function ee(S){return B(this,null,function*(){var O;const{api:k}=e;if(!k||!K(k))return at();try{S.status=P.UPLOADING;const G=yield(O=e.api)==null?void 0:O.call(e,{data:A({},e.uploadParams||{}),file:S.file,name:e.name,filename:e.filename},function(Ce){const Ke=Ce.loaded/Ce.total*100|0;S.percent=Ke}),{data:W}=G;return S.status=P.SUCCESS,S.responseData=W,{success:!0,error:null}}catch(G){return S.status=P.ERROR,{success:!1,error:G}}})}function Y(){return B(this,null,function*(){var k;const{maxNumber:S}=e;if(s.value.length+((k=e.previewFileList)==null?void 0:k.length)>S)return c.warning(a("component.upload.maxNumber",[S]));try{l.value=!0;const O=s.value.filter(Q=>Q.status!==P.SUCCESS)||[],G=yield Promise.all(O.map(Q=>ee(Q)));l.value=!1;const W=G.filter(Q=>!Q.success);if(W.length>0)throw W}catch(O){throw l.value=!1,O}})}function le(){const{maxNumber:S}=e;if(s.value.length>S)return c.warning(a("component.upload.maxNumber",[S]));if(l.value)return c.warning(a("component.upload.saveWarn"));const k=[];for(const O of s.value){const{status:G,responseData:W}=O;G===P.SUCCESS&&W&&k.push(W.url)}if(k.length<=0)return c.warning(a("component.upload.saveError"));s.value=[],r(),t("change",k)}function se(){return B(this,null,function*(){return l.value?(c.warning(a("component.upload.uploadWait")),!1):(s.value=[],!0)})}return{columns:gn(),actionColumn:hn(V),register:u,closeModal:r,getHelpText:p,getStringAccept:g,getOkButtonProps:D,beforeUpload:L,fileListRef:s,state:n,isUploadingRef:l,handleStartUpload:Y,handleOk:le,handleCloseFunc:se,getIsSelectFile:f,getUploadBtnText:T,t:a}}});const Sn={class:"upload-modal-toolbar"};function Cn(e,t,n,l,s,m){const d=b("a-button"),i=b("Alert"),o=b("Upload"),a=b("FileList"),u=b("BasicModal");return C(),$(u,X({width:"800px",title:e.t("component.upload.upload"),okText:e.t("component.upload.save")},e.$attrs,{onRegister:e.register,onOk:e.handleOk,closeFunc:e.handleCloseFunc,maskClosable:!1,keyboard:!1,class:"upload-modal",okButtonProps:e.getOkButtonProps,cancelButtonProps:{disabled:e.isUploadingRef}}),{centerFooter:F(()=>[h(d,{onClick:e.handleStartUpload,color:"success",disabled:!e.getIsSelectFile,loading:e.isUploadingRef},{default:F(()=>[N(M(e.getUploadBtnText),1)]),_:1},8,["onClick","disabled","loading"])]),default:F(()=>[Se("div",Sn,[h(i,{message:e.getHelpText,type:"info",banner:"",class:"upload-modal-toolbar__text"},null,8,["message"]),h(o,{accept:e.getStringAccept,multiple:e.multiple,"before-upload":e.beforeUpload,"show-upload-list":!1,class:"upload-modal-toolbar__btn"},{default:F(()=>[h(d,{type:"primary"},{default:F(()=>[N(M(e.t("component.upload.choose")),1)]),_:1})]),_:1},8,["accept","multiple","before-upload"])]),h(a,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])]),_:1},16,["title","okText","onRegister","onOk","closeFunc","okButtonProps","cancelButtonProps"])}const wn=H(bn,[["render",Cn]]),Fn=E({components:{BasicModal:Oe,FileList:ze},props:qt,emits:["list-change","register","delete"],setup(e,{emit:t}){const[n,{closeModal:l}]=Be(),{t:s}=q(),m=_([]);U(()=>e.value,o=>{ie(o)||(o=[]),m.value=o.filter(a=>!!a).map(a=>({url:a,type:a.split(".").pop()||"",name:a.split("/").pop()||""}))},{immediate:!0});function d(o){const a=m.value.findIndex(u=>u.url===o.url);if(a!==-1){const u=m.value.splice(a,1);t("delete",u[0].url),t("list-change",m.value.map(r=>r.url))}}function i(o){const{url:a=""}=o;$t({url:a})}return{t:s,register:n,closeModal:l,fileListRef:m,columns:yn(),actionColumn:vn({handleRemove:d,handleDownload:i})}}});function _n(e,t,n,l,s,m){const d=b("FileList"),i=b("BasicModal");return C(),$(i,X({width:"800px",title:e.t("component.upload.preview"),class:"upload-preview-modal"},e.$attrs,{onRegister:e.register,showOkBtn:!1}),{default:F(()=>[h(d,{dataSource:e.fileListRef,columns:e.columns,actionColumn:e.actionColumn},null,8,["dataSource","columns","actionColumn"])]),_:1},16,["title","onRegister"])}const An=H(Fn,[["render",_n]]),$n=E({name:"BasicUpload",components:{UploadModal:wn,Space:pt,UploadPreviewModal:An,Icon:ke,Tooltip:Le},props:Xt,emits:["change","delete","preview-delete","update:value"],setup(e,{emit:t,attrs:n}){const{t:l}=q(),[s,{openModal:m}]=Ae(),[d,{openModal:i}]=Ae(),o=_([]),a=R(()=>{const{emptyHidePreview:f}=e;return f&&f?o.value.length>0:!0}),u=R(()=>{const f=A(A({},n),e);return ne(f,"onChange")});U(()=>e.value,(f=[])=>{o.value=ie(f)?f:[]},{immediate:!0});function r(f){o.value=[...w(o),...f||[]],t("update:value",o.value),t("change",o.value)}function g(f){o.value=[...f||[]],t("update:value",o.value),t("change",o.value)}function p(f){t("delete",f)}function c(f){t("preview-delete",f)}return{registerUploadModal:s,openUploadModal:m,handleChange:r,handlePreviewChange:g,registerPreviewModal:d,openPreviewModal:i,fileList:o,showPreview:a,bindValue:u,handleDelete:p,handlePreviewDelete:c,t:l}}});function kn(e,t,n,l,s,m){const d=b("a-button"),i=b("Icon"),o=b("Tooltip"),a=b("Space"),u=b("UploadModal"),r=b("UploadPreviewModal");return C(),z("div",null,[h(a,null,{default:F(()=>[h(d,{type:"primary",onClick:e.openUploadModal,preIcon:"carbon:cloud-upload"},{default:F(()=>[N(M(e.t("component.upload.upload")),1)]),_:1},8,["onClick"]),e.showPreview?(C(),$(o,{key:0,placement:"bottom"},{title:F(()=>[N(M(e.t("component.upload.uploaded"))+" ",1),e.fileList.length?(C(),z(x,{key:0},[N(M(e.fileList.length),1)],64)):j("",!0)]),default:F(()=>[h(d,{onClick:e.openPreviewModal},{default:F(()=>[h(i,{icon:"bi:eye"}),e.fileList.length&&e.showPreviewNumber?(C(),z(x,{key:0},[N(M(e.fileList.length),1)],64)):j("",!0)]),_:1},8,["onClick"])]),_:1})):j("",!0)]),_:1}),h(u,X(e.bindValue,{previewFileList:e.fileList,onRegister:e.registerUploadModal,onChange:e.handleChange,onDelete:e.handleDelete}),null,16,["previewFileList","onRegister","onChange","onDelete"]),h(r,{value:e.fileList,onRegister:e.registerPreviewModal,onListChange:e.handlePreviewChange,onDelete:e.handlePreviewDelete},null,8,["value","onRegister","onListChange","onDelete"])])}const Rn=H($n,[["render",kn]]),Tn=ot(Rn),y=new Map;y.set("Input",ae);y.set("InputGroup",ae.Group);y.set("InputPassword",ae.Password);y.set("InputSearch",ae.Search);y.set("InputTextArea",ae.TextArea);y.set("InputNumber",ft);y.set("AutoComplete",mt);y.set("Select",Re);y.set("ApiSelect",Ot);y.set("ApiTree",Mt);y.set("TreeSelect",Te);y.set("ApiTreeSelect",jt);y.set("ApiRadioGroup",It);y.set("Switch",gt);y.set("RadioButtonGroup",Ft);y.set("RadioGroup",re.Group);y.set("Checkbox",Ie);y.set("CheckboxGroup",Ie.Group);y.set("ApiCascader",Ht);y.set("Cascader",ye);y.set("Slider",ht);y.set("Rate",yt);y.set("ApiTransfer",Zt);y.set("DatePicker",ce);y.set("MonthPicker",ce.MonthPicker);y.set("RangePicker",ce.RangePicker);y.set("WeekPicker",ce.WeekPicker);y.set("TimePicker",Ue);y.set("TimeRangePicker",Ue.TimeRangePicker);y.set("StrengthMeter",kt);y.set("IconPicker",Rt);y.set("InputCountDown",Tt);y.set("Upload",Tn);y.set("Divider",Pe);function Jn(e,t){y.set(e,t)}export{Ot as A,Tn as B,Yn as D,Wn as F,Qn as I,Vn as P,Kn as R,Ge as T,Hn as a,jt as b,y as c,It as d,un as e,Xn as f,qn as g,Zn as h,zn as i,Jn as j,en as u};
