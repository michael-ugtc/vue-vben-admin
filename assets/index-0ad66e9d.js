var Ie=Object.defineProperty,Pe=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var $e=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable;var re=(e,a,l)=>a in e?Ie(e,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[a]=l,I=(e,a)=>{for(var l in a||(a={}))$e.call(a,l)&&re(e,l,a[l]);if(se)for(var l of se(a))Ue.call(a,l)&&re(e,l,a[l]);return e},ie=(e,a)=>Pe(e,me(a));var ue=(e,a,l)=>new Promise((k,_)=>{var K=x=>{try{p(l.next(x))}catch(b){_(b)}},s=x=>{try{p(l.throw(x))}catch(b){_(b)}},p=x=>x.done?k(x.value):Promise.resolve(x.value).then(K,s);p((l=l.apply(e,a)).next())});import{an as je,d as Ce,f as Le,ag as He,c as O,w as m,Z as M,_ as U,u,N as Ve,ab as P,a8 as G,a9 as j,E as oe,a0 as de,a1 as he,l as v,F as Q,aa as Xe,ai as Ye,aj as Re,A as ze,m as qe,r as fe,H as R,h as H,o as We,n as ye,z as pe,ac as Ge,i as Je}from"./vue-ea98dac5.js";import{aE as Qe,k as Ze,u as et,a7 as tt,I as Z,aF as ke,N as nt,m as J,aG as at,ab as lt,aH as ct,a5 as st,a1 as rt,W as it,S as ge,x as ut}from"./index.js";import{aL as ot,aM as dt,aN as ht,q as ft,aO as yt,aP as pt,D as kt,aQ as gt,e as ee,aR as St,o as Kt,y as xt,ae as Ct,av as Se,a7 as Lt}from"./antd-51a19206.js";import{u as vt}from"./useContextMenu-30306118.js";function te(e,a){return a?typeof a=="string"?` ${e}--${a}`:Array.isArray(a)?a.reduce((l,k)=>l+te(e,k),""):Object.keys(a).reduce((l,k)=>l+(a[k]?te(e,k):""),""):""}function At(e){return(a,l)=>(a&&typeof a!="string"&&(l=a,a=""),a=a?`${e}__${a}`:e,`${a}${te(a,l)}`)}function ve(e){return[At(`${Qe}-${e}`)]}const Ke=Symbol(),xe=Symbol();function bt(e,a){if(!dt(e)||e[xe])return e;const{values:l,required:k,default:_,type:K,validator:s}=e,p=l||s?x=>{let b=!1,A=[];if(l&&(A=[...l,_],b||(b=A.includes(x))),s&&(b||(b=s(x))),!b&&A.length>0){const h=[...new Set(A)].map(t=>JSON.stringify(t)).join(", ");je(`Invalid prop: validation failed${a?` for prop "${a}"`:""}. Expected one of [${h}], got value ${JSON.stringify(x)}.`)}return b}:void 0;return{type:typeof K=="object"&&Object.getOwnPropertySymbols(K).includes(Ke)&&K?K[Ke]:K,required:!!k,default:_,validator:p,[xe]:!0}}const Et=e=>ot(Object.entries(e).map(([a,l])=>[a,bt(l,a)]));var T=(e=>(e[e.SELECT_ALL=0]="SELECT_ALL",e[e.UN_SELECT_ALL=1]="UN_SELECT_ALL",e[e.EXPAND_ALL=2]="EXPAND_ALL",e[e.UN_EXPAND_ALL=3]="UN_EXPAND_ALL",e[e.CHECK_STRICTLY=4]="CHECK_STRICTLY",e[e.CHECK_UN_STRICTLY=5]="CHECK_UN_STRICTLY",e))(T||{});const Tt=["update:expandedKeys","update:selectedKeys","update:value","change","check","update:searchValue"],_t=Et({value:{type:[Object,Array]},renderIcon:{type:Function},helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:Boolean,search:Boolean,searchValue:{type:String,default:""},checkStrictly:Boolean,clickRowToExpand:{type:Boolean,default:!1},checkable:Boolean,defaultExpandLevel:{type:[String,Number],default:""},defaultExpandAll:Boolean,fieldNames:{type:Object},treeData:{type:Array},actionList:{type:Array,default:()=>[]},expandedKeys:{type:Array,default:()=>[]},selectedKeys:{type:Array,default:()=>[]},checkedKeys:{type:[Array,Object],default:()=>[]},beforeRightClick:{type:Function,default:void 0},rightMenuList:{type:Array},filterFn:{type:Function,default:void 0},highlight:{type:[Boolean,String],default:!1},expandOnSearch:Boolean,checkOnSearch:Boolean,selectedOnSearch:Boolean,loading:{type:Boolean,default:!1},treeWrapperClassName:String}),Bt={key:2,class:"flex items-center flex-1 cursor-pointer justify-self-stretch"},wt=Ce({__name:"TreeHeader",props:{helpMessage:{type:[String,Array],default:""},title:{type:String,default:""},toolbar:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},search:{type:Boolean,default:!1},searchText:{type:String,default:""},checkAll:{type:Function,default:void 0},expandAll:{type:Function,default:void 0}},emits:["strictly-change","search"],setup(e,{emit:a}){const l=e,k=Le(""),[_]=ve("tree-header"),K=He(),{t:s}=Ze(),p=O(()=>["mr-1","w-full",{"ml-5":K.headerTitle||l.title}]),x=O(()=>{const{checkable:t}=l,c=[{label:s("component.tree.expandAll"),value:T.EXPAND_ALL},{label:s("component.tree.unExpandAll"),value:T.UN_EXPAND_ALL,divider:t}];return t?[{label:s("component.tree.selectAll"),value:T.SELECT_ALL},{label:s("component.tree.unSelectAll"),value:T.UN_SELECT_ALL,divider:t},...c,{label:s("component.tree.checkStrictly"),value:T.CHECK_STRICTLY},{label:s("component.tree.checkUnStrictly"),value:T.CHECK_UN_STRICTLY}]:c}),b=({key:t})=>{var c,r,d,o;switch(t){case T.SELECT_ALL:(c=l.checkAll)==null||c.call(l,!0);break;case T.UN_SELECT_ALL:(r=l.checkAll)==null||r.call(l,!1);break;case T.EXPAND_ALL:(d=l.expandAll)==null||d.call(l,!0);break;case T.UN_EXPAND_ALL:(o=l.expandAll)==null||o.call(l,!1);break;case T.CHECK_STRICTLY:a("strictly-change",!1);break;case T.CHECK_UN_STRICTLY:a("strictly-change",!0);break}};function A(t){a("search",t)}const h=et(A,200);return m(()=>k.value,t=>{h(t)}),m(()=>l.searchText,t=>{t!==k.value&&(k.value=t)}),(t,c)=>(M(),U("div",{class:he([u(_)(),"flex px-2 py-1.5 items-center"])},[u(K).headerTitle?Ve(t.$slots,"headerTitle",{key:0}):P("",!0),!u(K).headerTitle&&t.title?(M(),G(u(tt),{key:1,helpMessage:t.helpMessage},{default:j(()=>[oe(de(t.title),1)]),_:1},8,["helpMessage"])):P("",!0),t.search||t.toolbar?(M(),U("div",Bt,[t.search?(M(),U("div",{key:0,class:he(p.value)},[v(u(ht),{placeholder:u(s)("common.searchText"),size:"small",allowClear:"",value:k.value,"onUpdate:value":c[0]||(c[0]=r=>k.value=r)},null,8,["placeholder","value"])],2)):P("",!0),t.toolbar?(M(),G(u(kt),{key:1,onClick:c[1]||(c[1]=ze(()=>{},["prevent"]))},{overlay:j(()=>[v(u(ft),{onClick:b},{default:j(()=>[(M(!0),U(Q,null,Xe(x.value,r=>(M(),U(Q,{key:r.value},[v(u(yt),Ye(Re({key:r.value})),{default:j(()=>[oe(de(r.label),1)]),_:2},1040),r.divider?(M(),G(u(pt),{key:0})):P("",!0)],64))),128))]),_:1})]),default:j(()=>[v(Z,{icon:"ion:ellipsis-vertical"})]),_:1})):P("",!0)])):P("",!0)],2))}}),Ft=({icon:e})=>e?gt(e)?qe(Z,{icon:e,class:"mr-1"}):Z:null;function Nt(e,a){function l(h){const t=[],c=h||u(e),{key:r,children:d}=u(a);if(!d||!r)return t;for(let o=0;o<c.length;o++){const i=c[o];t.push(i[r]);const y=i[d];y&&y.length&&t.push(...l(y))}return t}function k(h){const t=[],c=h||u(e),{key:r,children:d}=u(a);if(!d||!r)return t;for(let o=0;o<c.length;o++){const i=c[o];i.disabled!==!0&&i.selectable!==!1&&t.push(i[r]);const y=i[d];y&&y.length&&t.push(...k(y))}return t}function _(h,t){const c=[],r=t||u(e),{key:d,children:o}=u(a);if(!o||!d)return c;for(let i=0;i<r.length;i++){const y=r[i],E=y[o];h===y[d]?(c.push(y[d]),E&&E.length&&c.push(...l(E))):E&&E.length&&c.push(..._(h,E))}return c}function K(h,t,c){if(!h)return;const r=c||u(e),{key:d,children:o}=u(a);if(!(!o||!d))for(let i=0;i<r.length;i++){const y=r[i],E=y[o];if(y[d]===h){r[i]=I(I({},r[i]),t);break}else E&&E.length&&K(h,t,y[o])}}function s(h=1,t,c=1){if(!h)return[];const r=[],d=t||u(e)||[];for(let o=0;o<d.length;o++){const i=d[o],{key:y,children:E}=u(a),z=y?i[y]:"",$=E?i[E]:[];r.push(z),$&&$.length&&c<h&&(c+=1,r.push(...s(h,$,c)))}return r}function p({parentKey:h=null,node:t,push:c="push"}){const r=ee(u(e));if(!h){r[c](t),e.value=r;return}const{key:d,children:o}=u(a);!o||!d||(ke(r,i=>{if(i[d]===h)return i[o]=i[o]||[],i[o][c](t),!0}),e.value=r)}function x({parentKey:h=null,list:t,push:c="push"}){const r=ee(u(e));if(!(!t||t.length<1))if(h){const{key:d,children:o}=u(a);if(!o||!d)return;ke(r,i=>{if(i[d]===h){i[o]=i[o]||[];for(let y=0;y<t.length;y++)i[o][c](t[y]);return e.value=r,!0}})}else{for(let d=0;d<t.length;d++)r[c](t[d]);e.value=r;return}}function b(h,t){if(!h)return;const c=t||u(e),{key:r,children:d}=u(a);if(!(!d||!r))for(let o=0;o<c.length;o++){const i=c[o],y=i[d];if(i[r]===h){c.splice(o,1);break}else y&&y.length&&b(h,i[d])}}function A(h,t,c){if(!h&&h!==0)return null;const r=t||u(e),{key:d,children:o}=u(a);return d?(r.forEach(i=>{if(c!=null&&c.key||(c==null?void 0:c.key)===0)return c;if(i[d]===h){c=i;return}i[o]&&i[o].length&&(c=A(h,i[o],c))}),c||null):null}return{deleteNodeByKey:b,insertNodeByKey:p,insertNodesByKey:x,filterByLevel:s,updateNodeByKey:K,getAllKeys:l,getChildrenKeys:_,getEnabledKeys:k,getSelectedNode:A}}function Dt(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Je(e)}const $t=Ce({name:"BasicTree",inheritAttrs:!1,props:_t,emits:Tt,setup(e,{attrs:a,slots:l,emit:k,expose:_}){const[K]=ve("tree"),s=fe({checkStrictly:e.checkStrictly,expandedKeys:e.expandedKeys||[],selectedKeys:e.selectedKeys||[],checkedKeys:e.checkedKeys||[]}),p=fe({startSearch:!1,searchText:"",searchData:[]}),x=Le([]),[b]=vt(),A=O(()=>{const{fieldNames:n}=e;return I({children:"children",title:"title",key:"key"},n)}),h=O(()=>{let n=ie(I(I({blockNode:!0},a),e),{expandedKeys:s.expandedKeys,selectedKeys:s.selectedKeys,checkedKeys:s.checkedKeys,checkStrictly:s.checkStrictly,fieldNames:u(A),"onUpdate:expandedKeys":f=>{s.expandedKeys=f,k("update:expandedKeys",f)},"onUpdate:selectedKeys":f=>{s.selectedKeys=f,k("update:selectedKeys",f)},onCheck:(f,C)=>{let g=R(s.checkedKeys);if(nt(g)&&p.startSearch){const L=C.node.eventKey;g=St(g,z(L)),C.checked&&g.push(L),s.checkedKeys=g}else s.checkedKeys=f;const S=R(s.checkedKeys);k("update:value",S),k("check",S,C)},onRightClick:Ee});return Kt(n,"treeData","class")}),t=O(()=>p.startSearch?p.searchData:u(x)),c=O(()=>!t.value||t.value.length===0),{deleteNodeByKey:r,insertNodeByKey:d,insertNodesByKey:o,filterByLevel:i,updateNodeByKey:y,getAllKeys:E,getChildrenKeys:z,getEnabledKeys:$,getSelectedNode:Ae}=Nt(x,A);function be(n,f){return!f&&e.renderIcon&&J(e.renderIcon)?e.renderIcon(n):f}function Ee(C){return ue(this,arguments,function*({event:n,node:f}){var F;const{rightMenuList:g=[],beforeRightClick:S}=e;let L={event:n,items:[]};if(S&&J(S)){let B=yield S(f,n);Array.isArray(B)?L.items=B:Object.assign(L,B)}else L.items=g;(F=L.items)!=null&&F.length&&(L.items=L.items.filter(B=>!B.hidden),b(L))})}function V(n){s.expandedKeys=n}function Te(){return s.expandedKeys}function ne(n){s.selectedKeys=n}function _e(){return s.selectedKeys}function ae(n){s.checkedKeys=n}function Be(){return s.checkedKeys}function le(n){s.checkedKeys=n?$():[]}function q(n){s.expandedKeys=n?E():[]}function we(n){s.checkStrictly=n}m(()=>e.searchValue,n=>{n!==p.searchText&&(p.searchText=n)},{immediate:!0}),m(()=>e.treeData,n=>{n&&W(p.searchText)});function W(n){if(n!==p.searchText&&(p.searchText=n),k("update:searchValue",n),!n){p.startSearch=!1;return}const{filterFn:f,checkable:C,expandOnSearch:g,checkOnSearch:S,selectedOnSearch:L}=u(e);p.startSearch=!0;const{title:F,key:B}=u(A),N=[];if(p.searchData=at(u(x),w=>{var X,Y;const D=f?f(n,w,u(A)):(Y=(X=w[F])==null?void 0:X.includes(n))!=null?Y:!1;return D&&N.push(w[B]),D},u(A)),g){const w=lt(p.searchData).map(D=>D[B]);w&&w.length&&V(w)}S&&C&&N.length&&ae(N),L&&N.length&&ne(N)}function Fe(n,f){if(!(!e.clickRowToExpand||!f||f.length===0))if(!s.expandedKeys.includes(n))V([...s.expandedKeys,n]);else{const C=[...s.expandedKeys],g=C.findIndex(S=>S===n);g!==-1&&C.splice(g,1),V(C)}}H(()=>{x.value=e.treeData}),We(()=>{const n=parseInt(e.defaultExpandLevel);n>0?s.expandedKeys=i(n):e.defaultExpandAll&&q(!0)}),H(()=>{s.expandedKeys=e.expandedKeys}),H(()=>{s.selectedKeys=e.selectedKeys}),H(()=>{s.checkedKeys=e.checkedKeys}),m(()=>e.value,()=>{s.checkedKeys=R(e.value||[])},{immediate:!0}),m(()=>s.checkedKeys,()=>{const n=R(s.checkedKeys);k("update:value",n),k("change",n)}),H(()=>{s.checkStrictly=e.checkStrictly});const Ne={setExpandedKeys:V,getExpandedKeys:Te,setSelectedKeys:ne,getSelectedKeys:_e,setCheckedKeys:ae,getCheckedKeys:Be,insertNodeByKey:d,insertNodesByKey:o,deleteNodeByKey:r,updateNodeByKey:y,getSelectedNode:Ae,checkAll:le,expandAll:q,filterByLevel:n=>{s.expandedKeys=i(n)},setSearchValue:n=>{W(n)},getSearchValue:()=>p.searchText};function De(n){const{actionList:f}=e;if(!(!f||f.length===0))return f.map((C,g)=>{var L;let S=!0;return J(C.show)?S=(L=C.show)==null?void 0:L.call(C,n):ge(C.show)&&(S=C.show),S?v("span",{key:g,class:K("action")},[C.render(n)]):null})}const Me=O(()=>{const n=ee(t.value);return ct(n,(f,C)=>{var ce;const g=p.searchText,{highlight:S}=u(e),{title:L,key:F,children:B}=u(A),N=be(f,f.icon),w=Lt(f,L),D=g?w.indexOf(g):-1,X=p.startSearch&&!it(g)&&S&&D!==-1,Y=`color: ${ge(S)?"#f50":S}`,Oe=X?v("span",{class:(ce=u(h))!=null&&ce.blockNode?`${K("content")}`:""},[v("span",null,[w.substr(0,D)]),v("span",{style:Y},[g]),v("span",null,[w.substr(D+g.length)])]):w;return f[L]=v("span",{class:`${K("title")} pl-2`,onClick:Fe.bind(null,f[F],f[B])},[l!=null&&l.title?ut(l,"title",f):v(Q,null,[N&&v(Ft,{icon:N},null),Oe,v("span",{class:K("actions")},[De(f)])])]),f}),n});return _(Ne),()=>{let n;const{title:f,helpMessage:C,toolbar:g,search:S,checkable:L}=e,F=f||g||S||l.headerTitle,B={height:"calc(100% - 38px)"};return v("div",{class:[K(),"h-full",a.class]},[F&&v(wt,{checkable:L,checkAll:le,expandAll:q,title:f,search:S,toolbar:g,helpMessage:C,onStrictlyChange:we,onSearch:W,searchText:p.searchText},Dt(n=st(l))?n:{default:()=>[n]}),v(xt,{wrapperClassName:u(e.treeWrapperClassName),spinning:u(e.loading),tip:"加载中..."},{default:()=>[ye(v(rt,{style:B},{default:()=>[v(Ct,Ge(u(h),{showIcon:!1,treeData:Me.value}),null)]}),[[pe,!u(c)]]),ye(v(Se,{image:Se.PRESENTED_IMAGE_SIMPLE,class:"!mt-4"},null),[[pe,u(c)]])]})])}}});export{$t as _};
